const fs = require('fs');
const path = require('path');

// 创建一个简单的PNG图标
function createSimpleIcon() {
  // 64x64像素的蓝色PNG图标数据
  const pngData = Buffer.from([
    0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A,
    0x00, 0x00, 0x00, 0x0D, 0x49, 0x48, 0x44, 0x52,
    0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x40,
    0x08, 0x02, 0x00, 0x00, 0x00, 0xFF, 0x80, 0x02,
    0x03, 0x00, 0x00, 0x5C, 0x49, 0x44, 0x41, 0x54,
    0x08, 0x99, 0x63, 0xFC, 0x0F, 0xC4, 0x00, 0x01,
    0x00, 0x00, 0x05, 0x00, 0x01, 0x0A, 0xF5, 0x33,
    0x9E, 0x00, 0x00, 0x00, 0x00, 0x49, 0x45, 0x4E,
    0x44, 0xAE, 0x42, 0x60, 0x82
  ]);
  
  const iconPath = path.join(__dirname, 'icon.png');
  fs.writeFileSync(iconPath, pngData);
  console.log('简单图标已创建:', iconPath);
  return iconPath;
}

// 创建一个更好的图标
function createBetterIcon() {
  // 创建一个64x64的蓝色圆形图标
  const width = 64;
  const height = 64;
  
  // 创建一个简单的蓝色圆形PNG
  const canvas = {
    width: width,
    height: height,
    data: Buffer.alloc(width * height * 4)
  };
  
  // 填充透明背景
  for (let i = 0; i < canvas.data.length; i += 4) {
    canvas.data[i] = 0;       // R
    canvas.data[i + 1] = 0;   // G
    canvas.data[i + 2] = 0;   // B
    canvas.data[i + 3] = 0;   // A (透明)
  }
  
  // 绘制蓝色圆形
  const centerX = width / 2;
  const centerY = height / 2;
  const radius = width / 2 - 4;
  
  for (let y = 0; y < height; y++) {
    for (let x = 0; x < width; x++) {
      const dx = x - centerX;
      const dy = y - centerY;
      const distance = Math.sqrt(dx * dx + dy * dy);
      
      if (distance <= radius) {
        const index = (y * width + x) * 4;
        canvas.data[index] = 30;     // R
        canvas.data[index + 1] = 144; // G
        canvas.data[index + 2] = 255; // B
        canvas.data[index + 3] = 255; // A (不透明)
      }
    }
  }
  
  // 添加白色文字 "ETX" (简化版)
  const textPixels = [
    [20, 20], [21, 20], [22, 20], [23, 20], [24, 20], [25, 20], [26, 20], [27, 20], [28, 20], [29, 20], [30, 20], [31, 20], [32, 20], [33, 20], [34, 20], [35, 20], [36, 20], [37, 20], [38, 20], [39, 20], [40, 20], [41, 20], [42, 20], [43, 20],
    [20, 21], [24, 21], [27, 21], [30, 21], [33, 21], [36, 21], [39, 21], [42, 21], [43, 21],
    [20, 22], [24, 22], [27, 22], [30, 22], [33, 22], [36, 22], [39, 22], [42, 22], [43, 22],
    [20, 23], [24, 23], [27, 23], [30, 23], [33, 23], [36, 23], [39, 23], [42, 23], [43, 23],
    [20, 24], [24, 24], [25, 24], [26, 24], [27, 24], [28, 24], [29, 24], [30, 24], [31, 24], [32, 24], [33, 24], [34, 24], [35, 24], [36, 24], [37, 24], [38, 24], [39, 24], [42, 24], [43, 24],
    [20, 25], [24, 25], [27, 25], [30, 25], [33, 25], [36, 25], [39, 25], [42, 25], [43, 25],
    [20, 26], [24, 26], [27, 26], [30, 26], [33, 26], [36, 26], [39, 26], [42, 26], [43, 26],
    [20, 27], [24, 27], [27, 27], [30, 27], [33, 27], [36, 27], [39, 27], [42, 27], [43, 27],
    [20, 28], [21, 28], [22, 28], [23, 28], [24, 28], [25, 28], [26, 28], [27, 28], [28, 28], [29, 28], [30, 28], [31, 28], [32, 28], [33, 28], [34, 28], [35, 28], [36, 28], [37, 28], [38, 28], [39, 28], [40, 28], [41, 28], [42, 28], [43, 28],
    [20, 29], [24, 29], [27, 29], [30, 29], [33, 29], [36, 29], [39, 29], [42, 29], [43, 29],
    [20, 30], [24, 30], [27, 30], [30, 30], [33, 30], [36, 30], [39, 30], [42, 30], [43, 30],
    [20, 31], [24, 31], [27, 31], [30, 31], [33, 31], [36, 31], [39, 31], [42, 31], [43, 31],
    [20, 32], [24, 32], [27, 32], [30, 32], [33, 32], [36, 32], [39, 32], [42, 32], [43, 32],
    [20, 33], [21, 33], [22, 33], [23, 33], [24, 33], [25, 33], [26, 33], [27, 33], [28, 33], [29, 33], [30, 33], [31, 33], [32, 33], [33, 33], [34, 33], [35, 33], [36, 33], [37, 33], [38, 33], [39, 33], [40, 33], [41, 33], [42, 33], [43, 33],
    [20, 34], [24, 34], [27, 34], [30, 34], [33, 34], [36, 34], [39, 34], [42, 34], [43, 34],
    [20, 35], [24, 35], [27, 35], [30, 35], [33, 35], [36, 35], [39, 35], [42, 35], [43, 35],
    [20, 36], [24, 36], [27, 36], [30, 36], [33, 36], [36, 36], [39, 36], [42, 36], [43, 36],
    [20, 37], [24, 37], [27, 37], [30, 37], [33, 37], [36, 37], [39, 37], [42, 37], [43, 37],
    [20, 38], [21, 38], [22, 38], [23, 38], [24, 38], [25, 38], [26, 38], [27, 38], [28, 38], [29, 38], [30, 38], [31, 38], [32, 38], [33, 38], [34, 38], [35, 38], [36, 38], [37, 38], [38, 38], [39, 38], [40, 38], [41, 38], [42, 38], [43, 38],
    [20, 39], [24, 39], [27, 39], [30, 39], [33, 39], [36, 39], [39, 39], [42, 39], [43, 39],
    [20, 40], [24, 40], [27, 40], [30, 40], [33, 40], [36, 40], [39, 40], [42, 40], [43, 40],
    [20, 41], [24, 41], [27, 41], [30, 41], [33, 41], [36, 41], [39, 41], [42, 41], [43, 41],
    [20, 42], [21, 42], [22, 42], [23, 42], [24, 42], [25, 42], [26, 42], [27, 42], [28, 42], [29, 42], [30, 42], [31, 42], [32, 42], [33, 42], [34, 42], [35, 42], [36, 42], [37, 42], [38, 42], [39, 42], [40, 42], [41, 42], [42, 42], [43, 42],
    [20, 43], [24, 43], [27, 43], [30, 43], [33, 43], [36, 43], [39, 43], [42, 43], [43, 43]
  ];
  
  // 绘制白色文字
  for (const [x, y] of textPixels) {
    if (x >= 0 && x < width && y >= 0 && y < height) {
      const index = (y * width + x) * 4;
      canvas.data[index] = 255;     // R
      canvas.data[index + 1] = 255; // G
      canvas.data[index + 2] = 255; // B
      canvas.data[index + 3] = 255; // A (不透明)
    }
  }
  
  // 保存为PNG
  const iconPath = path.join(__dirname, 'icon.png');
  fs.writeFileSync(iconPath, canvas.data);
  
  console.log('新图标已创建:', iconPath);
  return iconPath;
}

// 运行函数
try {
  createSimpleIcon();
} catch (error) {
  console.error('创建简单图标失败:', error);
  try {
    createBetterIcon();
  } catch (error2) {
    console.error('创建更好图标也失败:', error2);
  }
}